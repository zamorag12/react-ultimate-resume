{"ast":null,"code":"import _regeneratorRuntime from\"/home/gzamora/Documents/test/react-ultimate-resume/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/gzamora/Documents/test/react-ultimate-resume/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/gzamora/Documents/test/react-ultimate-resume/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useContext,useEffect,useRef,useState}from'react';import{StaticDataContext}from'../../../utils/context/contexts';var UNSPLASH_API='https://api.unsplash.com/search/photos?';export var useUnsplashResults=function useUnsplashResults(input){var page=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var limit=arguments.length>2&&arguments[2]!==undefined?arguments[2]:12;var timeout=arguments.length>3&&arguments[3]!==undefined?arguments[3]:800;var debounceSearch=useRef();var _useContext=useContext(StaticDataContext),endpoints=_useContext.endpoints;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),lastLoaded=_useState2[0],setLastLoaded=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),results=_useState4[0],setResults=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];useEffect(function(){if(!input||!endpoints.unsplashProxy){setResults([]);return;}if(input===(lastLoaded===null||lastLoaded===void 0?void 0:lastLoaded.input)&&page===(lastLoaded===null||lastLoaded===void 0?void 0:lastLoaded.page)){return;}setError(null);if(debounceSearch.current){clearTimeout(debounceSearch.current);}debounceSearch.current=setTimeout(function(){setLoading(true);var params={query:input,page:page*limit,per_page:limit};var url=encodeURI(UNSPLASH_API+Object.entries(params).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return\"\".concat(key,\"=\").concat(value);}).join('&'));// eslint-disable-next-line no-undef\nfetch(\"\".concat(endpoints.unsplashProxy,\"?url=\").concat(url),{method:'GET'}).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){var functionResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!\"\".concat(res.status).startsWith('2')){_context.next=7;break;}_context.next=3;return res.json();case 3:functionResult=_context.sent;if(!\"\".concat(functionResult===null||functionResult===void 0?void 0:functionResult.unsplashStatus).startsWith('2')){_context.next=6;break;}return _context.abrupt(\"return\",functionResult);case 6:throw new Error(\"\".concat(functionResult.unsplashStatus));case 7:throw new Error(\"\".concat(res.status,\" \").concat(res.statusText));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}()).then(function(res){var _res$data;setResults(res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.results.map(function(_ref4){var id=_ref4.id,user=_ref4.user,description=_ref4.description,urls=_ref4.urls,links=_ref4.links;return{id:id,urls:urls,user:user,description:description,links:links};}));}).catch(function(e){console.warn('Failed to fetch from unsplash',e.message);setError(e.message);}).finally(function(){setLastLoaded({input:input,page:page});debounceSearch.current=null;setLoading(false);});},timeout);},[input,lastLoaded,page]);return{results:results,loading:loading,error:error};};","map":{"version":3,"sources":["/home/gzamora/Documents/test/react-ultimate-resume/src/package/components/hooks/unsplash/use_unsplash_results.js"],"names":["useContext","useEffect","useRef","useState","StaticDataContext","UNSPLASH_API","useUnsplashResults","input","page","limit","timeout","debounceSearch","endpoints","lastLoaded","setLastLoaded","results","setResults","loading","setLoading","error","setError","unsplashProxy","current","clearTimeout","setTimeout","params","query","per_page","url","encodeURI","Object","entries","map","key","value","join","fetch","method","then","res","status","startsWith","json","functionResult","unsplashStatus","Error","statusText","data","id","user","description","urls","links","catch","e","console","warn","message","finally"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useRef, useState } from 'react';\n\nimport { StaticDataContext } from '../../../utils/context/contexts';\n\nconst UNSPLASH_API = 'https://api.unsplash.com/search/photos?';\n\nexport const useUnsplashResults = (input, page = 0, limit = 12, timeout = 800) => {\n    const debounceSearch = useRef();\n    const { endpoints } = useContext(StaticDataContext);\n    const [lastLoaded, setLastLoaded] = useState(false);\n    const [results, setResults] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        if (!input || !endpoints.unsplashProxy) {\n            setResults([]);\n            return;\n        }\n        if (input === lastLoaded?.input && page === lastLoaded?.page) {\n            return;\n        }\n        setError(null);\n        if (debounceSearch.current) {\n            clearTimeout(debounceSearch.current);\n        }\n        debounceSearch.current = setTimeout(() => {\n            setLoading(true);\n            const params = {\n                query: input,\n                page: page * limit,\n                per_page: limit\n            };\n            const url = encodeURI(\n                UNSPLASH_API +\n                    Object.entries(params)\n                        .map(([key, value]) => `${key}=${value}`)\n                        .join('&')\n            );\n            // eslint-disable-next-line no-undef\n            fetch(`${endpoints.unsplashProxy}?url=${url}`, {\n                method: 'GET'\n            })\n                .then(async (res) => {\n                    if (`${res.status}`.startsWith('2')) {\n                        const functionResult = await res.json();\n                        if (`${functionResult?.unsplashStatus}`.startsWith('2')) {\n                            return functionResult;\n                        }\n                        throw new Error(`${functionResult.unsplashStatus}`);\n                    }\n                    throw new Error(`${res.status} ${res.statusText}`);\n                })\n                .then((res) => {\n                    setResults(\n                        res?.data?.results.map(({ id, user, description, urls, links }) => ({\n                            id,\n                            urls,\n                            user,\n                            description,\n                            links\n                        }))\n                    );\n                })\n                .catch((e) => {\n                    console.warn('Failed to fetch from unsplash', e.message);\n                    setError(e.message);\n                })\n                .finally(() => {\n                    setLastLoaded({ input, page });\n                    debounceSearch.current = null;\n                    setLoading(false);\n                });\n        }, timeout);\n    }, [input, lastLoaded, page]);\n\n    return { results, loading, error };\n};\n"]},"metadata":{},"sourceType":"module"}